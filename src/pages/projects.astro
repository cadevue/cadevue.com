---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import ContentLayout from "../layouts/ContentLayout.astro";
import BackButton from "../components/BackButton.astro";
import ArrowIcon from "../components/ArrowIcon.astro";
import FilteredPortfolioGrid from "../components/FilteredPortfolioGrid.svelte";
import Chip from "../components/Chip.svelte";

const allProjects = await getCollection("projects");
const sortedProjects = allProjects.sort((a, b) => {
    return b.data.priority - a.data.priority;
});

const allTags = [...new Set(allProjects.flatMap((project) => project.data.tags))];
---

<BaseLayout title="All Projects - Addin Munawwar Portfolio | moonwr.dev" description="All projects that Addin Munawwar has worked on.">
    <main class="flex-1 bg-main-light py-16">
        <ContentLayout>
            <div class="mb-4" data-aos="fade-up" data-aos-delay="100">
                <BackButton light={false} />
            </div>
            <div class="flex items-center gap-2" data-aos="fade-up" data-aos-delay="200" id='portfolio-start'>
                <h1 class="mt-1">All Projects</h1>
                <span class="rotate-45">
                    <ArrowIcon color="#ba3a2c" size="40px"/>
                </span>
            </div>
            <p class="text-main-black mb-4" data-aos="fade-up" data-aos-delay="400">
                I'm still compiling all the projects I've worked on, but these are some!
            </p>
            <div class="w-full h-fit flex flex-col justify-between gap-2 lg:flex-row lg:gap-10">
                <div class="mt-4 h-fit w-full lg:w-48 lg:mt-6">
                    <p data-aos="fade-up" data-aos-delay="600">Filter by Tags</p>
                    <div class="flex flex-wrap gap-2 mt-2 lg:mt-4 lg:w-52" data-aos="fade-up" data-aos-delay="700">
                        {
                            allTags.map((tag : string) => {
                                return <Chip label={tag} active={true} client:visible />
                            })
                        }
                    </div>
                </div>
                <div class="h-0.5 w-full bg-main-gray mt-4 mb-2 lg:mb-0 lg:w-1 lg:h-screen"
                    data-aos="fade-up" data-aos-delay={(700 + allTags.length * 100).toString()}
                />
                <div class="flex-1">
                    <FilteredPortfolioGrid projects={sortedProjects} appearDelay={800} anchorElmt="#portfolio-start" client:load/>
                </div>
            </div>
        </ContentLayout>
    </main>
</BaseLayout>